<ul>
    <button href="#"> <%= current_user.email %> </button>
</ul>
<ul>
    <a href="/users/sign_out" data-method="delete"> Sign Out </a>
</ul>

<input id="pac-input" class="controls" type="text" placeholder="Search Box">
<div id="map"></div>

<p>아이콘 선택</p>
    <form name="tempset">
    <input type="radio" name="type" onclick="handleClick(this);" value="1">
    <input type="radio" name="type" onclick="handleClick(this);" value="2">
    <input type="radio" name="type" onclick="handleClick(this);" value="3">
</form>
<div id="formcontent"></div>
<div id="footer">
<adress>
    © 
    <strong>
        <a target="_blank">JEONBYULJUN Corp.</a>
    </strong>
</adress>
</div>

<script>

var temp = 1;
function handleClick(type){
    temp = type.value;
}

// This example displays a marker at the center of Australia.
// When the user clicks the marker, an info window opens.

function initMap() {
    
    mcOptions = {styles: [{
                    height: 45,
                    url: "c1.jpg",
                    width: 45
                },
                {
                    height: 55,
                    url: "c2.jpg",
                    width: 55
                },
                {
                    height: 65,
                    url: "c3.jpg",
                    width: 65
                },
                {
                    height: 75,
                    url: "c4.jpg",
                    width: 75
                },
                {
                    height: 85,
                    url: "c5.jpg",
                    width: 85
                }]};
    
    
    var mapCanvas = document.getElementById('map');
    var mapOptions = {
      center: new google.maps.LatLng(13, 121),
      zoom: 4,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = new google.maps.Map(mapCanvas, mapOptions);

    var input = document.getElementById('pac-input');
    var searchBox = new google.maps.places.SearchBox(input);

    var markerclusterer;
    var markers = [];

    map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
    
    map.addListener('bounds_changed', function() {
        searchBox.setBounds(map.getBounds());
    });
    
    searchBox.addListener('places_changed', function() {
        var places = searchBox.getPlaces();
    
        if (places.length == 0) {
          return;
        }
    

    
        // For each place, get the icon, name and location.
        var bounds = new google.maps.LatLngBounds();
        places.forEach(function(place) {
          var icon = {
            url: place.icon,
            size: new google.maps.Size(71, 71),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(17, 34),
            scaledSize: new google.maps.Size(25, 25)
          };
    
          // Create a marker for each place.
          new google.maps.Marker({
            map: map,
            icon: icon,
            title: place.name,
            position: place.geometry.location
          });
    
          if (place.geometry.viewport) {
            // Only geocodes have viewport.
            bounds.union(place.geometry.viewport);
          } else {
            bounds.extend(place.geometry.location);
          }
        });
        map.fitBounds(bounds);
    });
    

    <% @memos.each_with_index do |p ,i| %>
        if(<%=p.button%> == 1){
            var images = 'image.png';
        }
        else if(<%=p.button%> == 2){
            var images = 'images2.jpg';
        }
        else{
            var images = 'images3.jpg';
        }
        marker = new google.maps.Marker({
            map: map,
            icon: images,
            position: {lat: <%=p.lat%>, lng: <%=p.lng%>},
            animation: google.maps.Animation.DROP,
            draggable: true
        });
        



        (function(marker){
            var titletemp = "<%=p.title%>";
            var contenttemp = "<%=p.content%>";
            
            var contentString2 = 
            '<p>'+
            'title:'+
             titletemp +
            'content:'+
            contenttemp +
            '</p>'+
            '<%=form_tag '/delete', method:'post' do %>'+
            '<input type="hidden" name="id" value='+
            '<%=p.id%>'+
            '><input type="submit" value="아 제발 얼굴좀 지워"><% end %>';
            
            var infowindow = new google.maps.InfoWindow({
                content: contentString2
            });
            google.maps.event.addListener(infowindow, 'closeclick', function(){
                marker.setAnimation(null);
            });
            google.maps.event.addListener(marker, 'click', function(){
                infowindow.open(map,marker);
                marker.setAnimation(google.maps.Animation.BOUNCE);   
            })
            google.maps.event.addListener(marker, 'dragend', function(event){
                chlocation = event.latLng;
                var content =   '<%=form_tag '/make', method:'post' do %>'+
                                '<p>Do You Really Want To Change the position?</p>'+
                                '<input type="hidden" name="latitude" value='+
                                chlocation.lat()+
                                '><input type="hidden" name="longitude" value='+
                                chlocation.lng()+
                                '>'+
                                '<input type="hidden" name="btntype" value='+
                                temp+
                                '>'+

                                '</div>'+
                                '<input type="submit" value="네!!"><% end %>';
                infowindow2 = new google.maps.InfoWindow({
                    content: content
                });
                infowindow2.open(map, marker);
            })
        })(marker);
        markers.push(marker);
    <% end %>
    markerclusterer = new MarkerClusterer(map, markers, mcOptions);
    google.maps.event.addListener(map, 'rightclick', function(event) {
        if(temp == 1){
            var images = 'image.png';
        }
        else if(temp == 2){
            var images = 'images2.jpg';
        }
        else{
            var images = 'images3.jpg';
        }
        
        startLocation = event.latLng;
        var mark = new google.maps.Marker({
          position: startLocation,
          icon: images,
          map: map
        });
        mark.setAnimation(google.maps.Animation.BOUNCE);

        var contentString = '<div id="infobox">'+
                            '<div class="title">MY TRIP</div>'+
                            '<div class="input-group date" id="datetimepicker1" name="calendar">'+
                            '<%=form_tag '/make', method:'post' do %><ul><textarea name="tit" class="form-control" row="1"></textarea></ul><ul><textarea name="con" class="form-control" row="4"></textarea></ul>'+
                            '<input type="hidden" name="time" value=<%=Time.now%>>'+
                            '<input type="hidden" name="latitude" value='+
                            startLocation.lat()+
                            '><input type="hidden" name="longitude" value='+
                            startLocation.lng()+
                            '>'+
                            '<input type="hidden" name="btntype" value='+
                            temp+
                            '>'+
                            '<input type="text" class="form-control" />'+
                            '<input type="submit"><% end %>'+
                            '</div>';

        var infowindow = new google.maps.InfoWindow({
          content: contentString
          
        });
        
        mark.addListener('click', function(){
          infowindow.open(map, mark);
        });
        google.maps.event.addListener(infowindow, 'closeclick', function(){
            mark.setMap(null);
            
        });

        infowindow.open(map, mark);
        google.maps.event.addListener(infowindow, 'domready', function(){
           var checkin = $('#datetimepicker1').datepicker({
              onRender: function(date) {
                return date.valueOf() < now.valueOf() ? 'disabled' : '';
              }
            }).on('changeDate', function(ev) {
              if (ev.date.valueOf() > checkout.date.valueOf()) {
                var newDate = new Date(ev.date)
                newDate.setDate(newDate.getDate() + 1);
                checkout.setValue(newDate);
              }
              checkin.hide();
              $('#dpd2')[0].focus();
            }).data('datepicker');
        });
    });



}

</script>



<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC2xWsRsM--vAOE_I9dv-ljLh-nO6IU0pU&signed_in=false&libraries=places&callback=initMap"></script>
